var w=Object.defineProperty;var C=(i,e,s)=>e in i?w(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s;var a=(i,e,s)=>(C(i,typeof e!="symbol"?e+"":e,s),s);import{G as E,C as u,S as b,a as v,T as M,E as I,b as O,D as S,V as l,H as L,c as k,d as P,M as p,P as d,F as T,W as F,e as A,f as m}from"./vendor.70267072.js";import"./__commonjsHelpers__.04eeffaa.js";const R=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function s(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerpolicy&&(n.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?n.credentials="include":t.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(t){if(t.ep)return;t.ep=!0;const n=s(t);fetch(t.href,n)}};R();class B{constructor(e){a(this,"scene");this.scene=e}grid(){var e=new E("groundMaterial",this.scene);return e.majorUnitFrequency=5,e.minorUnitVisibility=.5,e.gridRatio=1,e.opacity=.9,e.useMaxLine=!0,e.lineColor=u.Teal(),e.mainColor=u.Black(),e}skybox(e){const s=new b("skyBoxMaterial",this.scene);return s.backFaceCulling=!1,s.reflectionTexture=new v("textures/skybox/toySky",this.scene),s.reflectionTexture.coordinatesMode=M.SKYBOX_MODE,s.diffuseColor=new u(0,0,0),s.specularColor=new u(0,0,0),s}grayColor(){const e=new b("grayColor",this.scene);return e.diffuseColor=u.Gray(),e.emissiveColor=u.Teal(),e}}class x{constructor(e){a(this,"xrExperience");a(this,"engine");a(this,"scene");a(this,"ground");a(this,"mats");this.canvas=e,this.engine=new I(e),window.addEventListener("resize",()=>{this.engine.resize()}),this.scene=this.createScene(),this.initGround(),this.addSkybox(),this.initXRExperience()}createScene(){var e=new O(this.engine);this.mats=new B(e);var s=new S("dir01",new l(-1,-2,-1),e);s.position=new l(-5,10,5),s.intensity=.5,new L("light",new l(1,1,0),e),e.enablePhysics(void 0,new k(void 0,void 0,P));const r=p.CreateSphere("target",{diameter:.5},e);r.position.y=2,r.material=this.mats.grayColor(),r.physicsImpostor=new d(r,d.SphereImpostor,{mass:1,restitution:.5},e);const t=p.CreateGround("ground",{width:6,height:2},e);return t.position.y=1,t.physicsImpostor=new d(t,d.BoxImpostor,{mass:0}),e}initFreeCam(e){console.log("Enable Free Camera");var s=new T("camera1",new l(0,2.5,-6),this.scene);s.setTarget(l.Zero()),s.attachControl(e,!0),s.checkCollisions=!0,s.applyGravity=!0}initGround(){this.ground=p.CreateGround("Ground",{width:100,height:100}),this.ground.material=this.mats.grid(),this.ground.checkCollisions=!0,this.ground.physicsImpostor=new d(this.ground,d.BoxImpostor,{mass:0})}async initXRExperience(){const e=await F.IsSessionSupportedAsync("immersive-vr");console.log(`Is this browser support VR: ${e}`);const s=A.GetAvailableFeatures();console.log(s),this.xrExperience=await this.scene.createDefaultXRExperienceAsync({disableTeleportation:!0,uiOptions:{sessionMode:"immersive-vr"}});const r=this.xrExperience.baseExperience.featuresManager,t=[new l(0,0,5),new l(5,0,5)];r.enableFeature(m.TELEPORTATION,"stable",{xrInput:this.xrExperience.input,floorMeshes:[this.ground],snapPositions:t});const n=this.xrExperience.baseExperience.camera;console.log(n.position),r.enableFeature(m.POINTER_SELECTION,"stable",{xrInput:this.xrExperience.input,enablePointerSelectionOnAllControllers:!0}),window.navigator.userAgent.includes("OculusBrowser")&&r.enableFeature(m.HAND_TRACKING,"latest",{xrInput:this.xrExperience.input,jointMeshes:{enablePhysics:!0}}),this.xrExperience.input.onControllerAddedObservable.add(h=>{h.onMotionControllerInitObservable.add(g=>{var o;g.getComponentIds();let c=g.getComponentOfType("squeeze");c&&c.onButtonStateChangedObservable.add(()=>{var y,f;if(c!=null&&c.changes.pressed)if(c.pressed){if(o=this.scene.meshUnderPointer,console.log(o&&o.name),!o.name.includes("target"))return;o.setParent(g.rootMesh),(y=o.physicsImpostor)==null||y.setMass(0)}else o.setParent(null),(f=o.physicsImpostor)==null||f.setMass(1)})})})}addSkybox(){const e=p.CreateBox("skyBox",{size:100},this.scene);e.material=this.mats.skybox(500)}debug(e=!0){window.addEventListener("keydown",s=>{s.shiftKey&&s.ctrlKey&&s.altKey&&s.keyCode===73&&(this.scene.debugLayer.isVisible()?this.scene.debugLayer.hide():this.scene.debugLayer.show())})}async run(){this.debug(),console.log("Ammo Engin loaded."),this.engine.runRenderLoop(()=>{this.scene.render()})}}console.log(`main.ts starting ${x.name}`);window.addEventListener("DOMContentLoaded",async()=>{let i=document.getElementById("renderCanvas"),e=new x(i);e.debug(!1),e.run()});
